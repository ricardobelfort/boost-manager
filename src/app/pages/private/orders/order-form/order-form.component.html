<app-breadcrumb [items]="breadcrumb" />
<div class="bg-white rounded-xl shadow-sm p-8">
  <div class="flex items-center justify-between mb-4">
    <div class="flex items-center gap-3 mb-3">
      <div *ngIf="selectedGame as game">
        <img [src]="game.image" [alt]="game.name" class="w-18 h-18 rounded-xl object-cover shadow mr-2" />
      </div>
      <div>
        <h2 class="!text-3xl font-bold text-black">
          {{ editingId ? 'Edit Order' : 'New Order' }}
          <span *ngIf="editingId && orderForm.value.order_number" class="text-gray-400 ml-2"
            >#{{ orderForm.value.order_number }}</span
          >
        </h2>
        <p class="text-gray-500">
          {{ editingId ? 'Editing an existing order.' : 'Here you can create a New Order.' }}
        </p>
      </div>
    </div>
  </div>

  <div class="w-full p-8 border border-gray-200 rounded-xl">
    <p-tabs value="0">
      <p-tablist>
        <p-tab value="0"><i class="pi pi-trophy text-lime-500"></i> Rank Boost</p-tab>
        <p-tab value="1"><i class="pi pi-users text-blue-400"></i> Bot Lobbies</p-tab>
        <p-tab value="2"><i class="pi pi-star text-yellow-400"></i> Camo Service</p-tab>
        <p-tab value="3"><i class="pi pi-chart-line text-purple-500"></i> Power Leveling</p-tab>
        <p-tab value="4"><i class="pi pi-box text-orange-500"></i> Account Premade</p-tab>
        <p-tab value="5"><i class="pi pi-comment text-gray-500"></i> Custom Request</p-tab>
      </p-tablist>

      <p-tabpanels>
        <!-- RANK BOOST -->
        <p-tabpanel value="0" class="px-8">
          <form [formGroup]="rankBoostForm" (ngSubmit)="saveRankBoost()">
            <div class="bg-gray-50 rounded-xl shadow-xs p-8 mb-6">
              <h3 class="font-semibold text-2xl text-gray-800 flex items-center gap-2">Rank Boost Details</h3>
              <p>Fill your details below to create a Rank Boost order.</p>
              <p-divider class="!mb-10" />
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="flex flex-col gap-6">
                  <div>
                    <div class="flex items-center gap-2 mb-4">
                      <img [src]="getRankObj(rankBoostForm.value.currentRank ?? '').image" width="70" alt="" class="mb-4" />
                      <div class="mb-4">
                        <h2 class="block mb-2 text-gray-700">Current Rank</h2>
                        <p class="text-3xl font-bold text-gray-600">{{ getRankObj(rankBoostForm.value.currentRank ?? '').label }}</p>
                      </div>
                    </div>
                    <label class="block mb-2 font-medium text-gray-700"> Current Rank </label>
                    <p-select
                      [options]="currentRankOptions"
                      formControlName="currentRank"
                      styleClass="w-full"
                      placeholder="Select a rank"
                    ></p-select>
                  </div>
                  <div>
                    <label class="block mb-2 font-medium text-gray-700">Current SR</label>
                    <input
                      type="number"
                      pInputText
                      formControlName="currentSr"
                      min="0"
                      max="10000"
                      class="w-full"
                      placeholder="0"
                    />
                  </div>
                  <div>
                    <label class="block mb-2 font-medium text-gray-700">Game</label>
                    <p-select
                      [options]="chooseGame"
                      formControlName="game"
                      styleClass="w-full"
                      placeholder="Select a game"
                    ></p-select>
                  </div>
                </div>

                <div class="flex flex-col gap-6">
                  <div>
                    <div class="flex items-center gap-2 mb-4">
                      <img [src]="getRankObj(rankBoostForm.value.desiredRank ?? '').image" width="70" alt="" class="mb-4" />
                      <div class="mb-4">
                        <h2 class="block mb-2 text-gray-700">Desired Rank</h2>
                        <p class="text-3xl font-bold text-gray-600">{{ getRankObj(rankBoostForm.value.desiredRank ?? '').label }}</p>
                      </div>
                    </div>
                    <label class="block mb-2 font-medium text-gray-700"> Desired Rank </label>
                    <p-select
                      [options]="desiredRankOptions"
                      formControlName="desiredRank"
                      styleClass="w-full"
                      placeholder="Select a rank"
                    ></p-select>
                  </div>
                  <div>
                    <label class="block mb-2 font-medium text-gray-700">Desired SR</label>
                    <input
                      type="number"
                      pInputText
                      formControlName="desiredSr"
                      min="0"
                      max="10000"
                      class="w-full"
                      placeholder="0"
                    />
                  </div>
                  <div>
                    <label class="block mb-2 font-medium text-gray-700">Platform</label>
                    <p-select
                      [options]="choosePlatform"
                      formControlName="platform"
                      styleClass="w-full"
                      placeholder="Select a platform"
                    ></p-select>
                  </div>
                </div>
              </div>
              <div class="mt-6">
                <label class="block mb-2 font-medium text-gray-700">Additional Info</label>
                <textarea
                  pTextarea
                  formControlName="notes"
                  rows="3"
                  class="w-full"
                  placeholder="Anything important..."
                ></textarea>
              </div>
            </div>
            <div class="flex justify-center md:justify-end gap-4 mt-2">
              <p-button label="Cancel" variant="outlined" severity="secondary" (click)="onCancel()" />
              <p-button label="Save Order" icon="pi pi-check" [disabled]="rankBoostForm.invalid" (click)="onSubmit()" />
            </div>
          </form>
        </p-tabpanel>

        <!-- BOT LOBBIES -->
        <p-tabpanel value="1">
          <form [formGroup]="botLobbyForm" (ngSubmit)="saveBotLobby()">
            <div class="bg-gray-50 rounded-xl shadow-sm p-8 mb-6">
              <h3 class="font-semibold text-2xl text-gray-800 flex items-center gap-2">Bot Lobby Details</h3>
              <p class="mb-6">Fill your details below to create a Bot Lobby order.</p>
              <p-divider class="!mb-10" />
              <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div>
                  <label class="block mb-2 font-medium text-gray-700">Number of bot lobbies</label>
                  <input type="number" pInputText formControlName="botLobbies" min="1" class="w-full" placeholder="1" />
                </div>
                <div>
                  <label class="block mb-2 font-medium text-gray-700">Supplier</label>
                  <p-select
                    [options]="suppliers"
                    formControlName="supplier"
                    styleClass="w-full"
                    placeholder="Select..."
                  ></p-select>
                </div>
                <div>
                  <label class="block mb-2 font-medium text-gray-700">Supplier order</label>
                  <input
                    pInputText
                    formControlName="supplierOrder"
                    class="w-full"
                    placeholder="Supplier order number..."
                  />
                </div>
              </div>
              <div class="mt-6">
                <label class="block mb-2 font-medium text-gray-700">Additional Info</label>
                <textarea
                  pTextarea
                  formControlName="notes"
                  rows="3"
                  class="w-full"
                  placeholder="Anything important..."
                ></textarea>
              </div>
            </div>
            <div class="flex justify-center md:justify-end gap-4 mt-2">
              <p-button label="Cancel" variant="outlined" severity="secondary" (click)="onCancel()" />
              <p-button label="Save Order" icon="pi pi-check" [disabled]="botLobbyForm.invalid" (click)="onSubmit()" />
            </div>
          </form>
        </p-tabpanel>

        <!-- CAMO SERVICE -->
        <p-tabpanel value="2">
          <form [formGroup]="camoServiceForm" (ngSubmit)="saveCamoService()">
            <div class="bg-gray-50 rounded-xl shadow-sm p-8 mb-6">
              <h3 class="font-semibold text-lg text-gray-800 flex items-center gap-2">Camo Service Details</h3>
              <p class="mb-6">Fill your details below to create a Camo Service order.</p>
              <p-divider class="!mb-10" />
              <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div>
                  <label class="block mb-2 font-medium text-gray-700">Desired camo</label>
                  <p-select
                    [options]="camos"
                    formControlName="desiredCamo"
                    styleClass="w-full"
                    placeholder="Select..."
                  ></p-select>
                </div>
                <div>
                  <label class="block mb-2 font-medium text-gray-700">Game</label>
                  <p-select
                    [options]="chooseGame"
                    formControlName="game"
                    styleClass="w-full"
                    placeholder="Select a game"
                  ></p-select>
                </div>
                <div>
                  <label class="block mb-2 font-medium text-gray-700">Platform</label>
                  <p-select
                    [options]="platforms"
                    formControlName="platform"
                    styleClass="w-full"
                    placeholder="Select a platform"
                  ></p-select>
                </div>
              </div>
              <div class="mt-6">
                <label class="block mb-2 font-medium text-gray-700">Additional Info</label>
                <textarea
                  pTextarea
                  formControlName="notes"
                  rows="3"
                  class="w-full"
                  placeholder="Anything important..."
                ></textarea>
              </div>
            </div>
            <div class="flex justify-center md:justify-end gap-4 mt-2">
              <p-button label="Cancel" variant="outlined" severity="secondary" (click)="onCancel()" />
              <p-button label="Save Order" icon="pi pi-check" [disabled]="camoServiceForm.invalid" (click)="onSubmit()" />
            </div>
          </form>
        </p-tabpanel>

        <!-- POWER LEVELING -->
        <p-tabpanel value="3">
          <form [formGroup]="powerLevelingForm" (ngSubmit)="savePowerLeveling()">
            <div class="bg-gray-50 rounded-xl shadow-sm p-8 mb-6">
              <h3 class="font-semibold text-lg text-gray-800 flex items-center gap-2">Power Leveling Details</h3>
              <p class="mb-6">Fill your details below to create a Power Leveling order.</p>
              <p-divider class="!mb-10" />
              <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                <div>
                  <label class="block mb-2 font-medium text-gray-700">Current level</label>
                  <input
                    type="number"
                    pInputText
                    formControlName="currentLevel"
                    min="1"
                    class="w-full"
                    placeholder="1"
                  />
                </div>
                <div>
                  <label class="block mb-2 font-medium text-gray-700">Desired level</label>
                  <input
                    type="number"
                    pInputText
                    formControlName="desiredLevel"
                    min="1"
                    class="w-full"
                    placeholder="55"
                  />
                </div>
                <div>
                  <label class="block mb-2 font-medium text-gray-700">Game</label>
                  <p-select
                    [options]="chooseGame"
                    formControlName="game"
                    styleClass="w-full"
                    placeholder="Select a game"
                  ></p-select>
                </div>
                <div>
                  <label class="block mb-2 font-medium text-gray-700">Platform</label>
                  <p-select
                    [options]="platforms"
                    formControlName="platform"
                    styleClass="w-full"
                    placeholder="Select a platform"
                  ></p-select>
                </div>
              </div>
              <div class="mt-6">
                <label class="block mb-2 font-medium text-gray-700">Additional Info</label>
                <textarea
                  pTextarea
                  formControlName="notes"
                  rows="3"
                  class="w-full"
                  placeholder="Anything important..."
                ></textarea>
              </div>
            </div>
            <div class="flex justify-center md:justify-end gap-4 mt-2">
              <p-button label="Cancel" variant="outlined" severity="secondary" (click)="onCancel()" />
              <p-button label="Save Order" icon="pi pi-check" [disabled]="powerLevelingForm.invalid" (click)="onSubmit()" />
            </div>
          </form>
        </p-tabpanel>

        <!-- ACCOUNT PREMADE -->
        <p-tabpanel value="4">
          <form [formGroup]="accountPremadeForm" (ngSubmit)="saveAccountPremade()">
            <div class="bg-gray-50 rounded-xl shadow-sm p-8 mb-6">
              <h3 class="font-semibold text-lg text-gray-800 flex items-center gap-2">Account Premade Details</h3>
              <p class="mb-6">Fill your details below to create an Account Premade order.</p>
              <p-divider class="!mb-10" />
              <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div>
                  <label class="block mb-2 font-medium text-gray-700">Account Email</label>
                  <input
                    type="email"
                    pInputText
                    formControlName="accountEmail"
                    class="w-full"
                    placeholder="Enter account email"
                  />
                </div>
                <div>
                  <label class="block mb-2 font-medium text-gray-700">Account Password</label>
                  <input
                    type="password"
                    pInputText
                    formControlName="accountPassword"
                    class="w-full"
                    placeholder="Enter account password"
                  />
                </div>
                <div>
                  <label class="block mb-2 font-medium text-gray-700">Choose Camo</label>
                  <p-select
                    [options]="camos"
                    formControlName="availableCamo"
                    styleClass="w-full"
                    placeholder="Select a camo"
                  ></p-select>
                </div>
              </div>
              <div class="mt-6">
                  <label class="block mb-2 font-medium text-gray-700">Additional Info</label>
                  <textarea
                    pTextarea
                    formControlName="notes"
                    rows="3"
                    class="w-full"
                    placeholder="Anything important..."
                  ></textarea>
                </div>
            </div>
            <div class="flex justify-center md:justify-end gap-4 mt-2">
              <p-button label="Cancel" variant="outlined" severity="secondary" (click)="onCancel()" />
              <p-button label="Save Order" icon="pi pi-check" [disabled]="accountPremadeForm.invalid" (click)="onSubmit()" />
            </div>
          </form>
        </p-tabpanel>

        <!-- CUSTOM REQUEST -->
        <p-tabpanel value="5">
          <form [formGroup]="customRequestForm" (ngSubmit)="saveCustomRequest()">
            <div class="bg-gray-50 rounded-xl shadow-sm p-8 mb-6">
              <h3 class="font-semibold text-lg text-gray-800 flex items-center gap-2">Custom Request</h3>
              <p class="mb-6">Fill your details below about the Custom Request order.</p>
              <p-divider class="!mb-10" />
              <div>
                <label class="block mb-2 font-medium text-gray-700">Details</label>
                <textarea
                  pTextarea
                  formControlName="notes"
                  rows="6"
                  class="w-full"
                  placeholder="Describe your custom request..."
                ></textarea>
              </div>
            </div>
            <div class="flex justify-center md:justify-end gap-4 mt-2">
              <p-button label="Cancel" variant="outlined" severity="secondary" (click)="onCancel()" />
              <p-button label="Save Order" icon="pi pi-check" [disabled]="customRequestForm.invalid" (click)="onSubmit()" />
            </div>
          </form>
        </p-tabpanel>
      </p-tabpanels>
    </p-tabs>
  </div>

  <form [formGroup]="orderForm" (ngSubmit)="onSubmit()" class="flex flex-col gap-6">
    <div class="w-full">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 w-full" *ngIf="isBotLobby()">
        <div>
          <label class="font-medium text-gray-700 mb-2 block">Supplier <span class="text-red-500">*</span></label>
          <p-select
            styleClass="w-full"
            [options]="suppliers"
            formControlName="supplier"
            placeholder="Select a supplier"
          ></p-select>
        </div>
        <div>
          <label class="font-medium text-gray-700 mb-2 block">Custome ID <span class="text-red-500">*</span></label>
          <input
            [style]="{ width: '100%' }"
            styleClass="w-full"
            pInputText
            formControlName="external_supplier_id"
            placeholder="Enter the external supplier ID"
            type="text"
          />
        </div>
      </div>
    </div>

    <!-- Full Form -->
    <div *ngIf="!isBotLobby()">
      <!-- Row 2: account data -->
      <div class="mb-4">
        <h3 class="text-lg font-semibold text-gray-800 mb-2">Account Data</h3>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div class="flex flex-col">
            <label class="font-medium text-gray-700 mb-2 block">
              Account Email <span class="text-red-500">*</span>
            </label>
            <input
              styleClass="w-full"
              pInputText
              formControlName="account_email"
              placeholder="Enter your email"
              type="email"
            />
            <small
              *ngIf="
                orderForm.get('account_email')?.errors?.['required'] &&
                (orderForm.get('account_email')?.dirty || orderForm.get('account_email')?.touched)
              "
              class="text-red-500"
            >
              Email is required.
            </small>
            <small
              *ngIf="
                orderForm.get('account_email')?.errors?.['email'] &&
                (orderForm.get('account_email')?.dirty || orderForm.get('account_email')?.touched)
              "
              class="text-red-500"
            >
              Invalid email.
            </small>
          </div>
          <div class="flex flex-col">
            <label class="font-medium text-gray-700 mb-2 block">
              Account Password <span class="text-red-500">*</span>
            </label>
            <input
              styleClass="w-full"
              pInputText
              formControlName="account_password"
              placeholder="Enter your password"
              type="text"
            />
            <small
              *ngIf="
                orderForm.get('account_password')?.errors?.['required'] &&
                (orderForm.get('account_password')?.dirty || orderForm.get('account_password')?.touched)
              "
              class="text-red-500"
            >
              Password is required.
            </small>
          </div>
          <div class="flex flex-col">
            <label class="font-medium text-gray-700 mb-2 block"> Backup Codes </label>
            <input
              styleClass="w-full"
              pInputText
              formControlName="recovery_code"
              placeholder="Enter the backup code"
              type="text"
            />
          </div>
          <div class="flex flex-col">
            <label class="font-medium text-gray-700 mb-2 block"> Recovery Email </label>
            <input
              styleClass="w-full"
              pInputText
              formControlName="recovery_email"
              placeholder="Enter the recovery email"
              type="text"
            />
            <small
              *ngIf="
                orderForm.get('recovery_email')?.errors?.['required'] &&
                (orderForm.get('recovery_email')?.dirty || orderForm.get('recovery_email')?.touched)
              "
              class="text-red-500"
            >
              Recovery email is required.
            </small>
          </div>
          <div class="flex flex-col">
            <label class="font-medium text-gray-700 mb-2 block"> Platform <span class="text-red-500">*</span> </label>
            <p-select
              styleClass="w-full"
              [options]="platforms"
              formControlName="platform"
              placeholder="Select a platform"
            ></p-select>
            <small
              *ngIf="
                orderForm.get('platform')?.invalid &&
                (orderForm.get('platform')?.dirty || orderForm.get('platform')?.touched)
              "
              class="text-red-500"
            >
              Please select a platform.
            </small>
          </div>
        </div>
      </div>

      <!-- Row 1: selects -->
      <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
        <div>
          <label class="font-medium text-gray-700 mb-2 block"> Service Type <span class="text-red-500">*</span> </label>
          <p-select
            styleClass="w-full"
            [options]="getFilteredServiceTypes()"
            formControlName="service_type"
            placeholder="Select a service type"
          ></p-select>
          <small
            *ngIf="
              orderForm.get('service_type')?.invalid &&
              (orderForm.get('service_type')?.dirty || orderForm.get('service_type')?.touched)
            "
            class="text-red-500"
          >
            Please select a service type.
          </small>
        </div>
        <div>
          <label class="font-medium text-gray-700 mb-2 block"> Supplier <span class="text-red-500">*</span> </label>
          <p-select
            styleClass="w-full"
            [options]="suppliers"
            formControlName="supplier"
            placeholder="Select a supplier"
          ></p-select>
          <small
            *ngIf="
              orderForm.get('supplier')?.invalid &&
              (orderForm.get('supplier')?.dirty || orderForm.get('supplier')?.touched)
            "
            class="text-red-500"
          >
            Please select a supplier.
          </small>
        </div>
        <div>
          <label class="font-medium text-gray-700 mb-2 block"> Booster <span class="text-red-500">*</span> </label>
          <p-select
            styleClass="w-full"
            [options]="boosters"
            formControlName="booster"
            placeholder="Select a booster"
          ></p-select>
          <small
            *ngIf="
              orderForm.get('booster')?.invalid &&
              (orderForm.get('booster')?.dirty || orderForm.get('booster')?.touched)
            "
            class="text-red-500"
          >
            Please select a booster.
          </small>
        </div>
        <div>
          <div
            *ngIf="
              typeof (orderForm.get('service_type')?.value ?? '') === 'string' &&
              (orderForm.get('service_type')?.value ?? '').toLowerCase().includes('camuflagem')
            "
          >
            <label class="font-medium text-gray-700 mb-2 block"> Weapon Quantity </label>
            <p-inputnumber
              formControlName="weapon_quantity"
              [max]="58"
              [showButtons]="true"
              styleClass="w-full"
              placeholder="Ex: 1"
            ></p-inputnumber>
            <small
              *ngIf="
                orderForm.get('weapon_quantity')?.errors?.['max'] &&
                (orderForm.get('weapon_quantity')?.dirty || orderForm.get('weapon_quantity')?.touched)
              "
              class="text-red-500"
            >
              Maximum 58 weapons.
            </small>
          </div>
        </div>
      </div>

      <!-- Row 3: dates -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
        <div>
          <label class="font-medium text-gray-700 mb-2 block"> Start Date <span class="text-red-500">*</span> </label>
          <p-datepicker
            styleClass="w-full"
            formControlName="start_date"
            dateFormat="dd/mm/yy"
            placeholder="Select start date"
            [showIcon]="true"
            [showButtonBar]="true"
            [selectOtherMonths]="true"
            [minDate]="hoje"
          ></p-datepicker>
          <small
            *ngIf="
              orderForm.get('start_date')?.errors?.['required'] &&
              (orderForm.get('start_date')?.dirty || orderForm.get('start_date')?.touched)
            "
            class="text-red-500"
          >
            Start date is required.
          </small>
          <small
            *ngIf="
              orderForm.get('start_date')?.errors?.['minDate'] &&
              (orderForm.get('start_date')?.dirty || orderForm.get('start_date')?.touched)
            "
            class="text-red-500"
          >
            Start date must be greater than or equal to today.
          </small>
          <small
            *ngIf="
              orderForm.get('start_date')?.errors?.['maxDate'] &&
              (orderForm.get('start_date')?.dirty || orderForm.get('start_date')?.touched)
            "
            class="text-red-500"
          >
            Start date cannot be after end date.
          </small>
        </div>
        <div>
          <label class="font-medium text-gray-700 mb-2 block"> End Date </label>
          <p-datepicker
            styleClass="w-full"
            formControlName="end_date"
            dateFormat="dd/mm/yy"
            placeholder="Select end date"
            [showIcon]="true"
            [showButtonBar]="true"
            [selectOtherMonths]="true"
            [minDate]="hoje"
          ></p-datepicker>
          <small
            *ngIf="
              orderForm.get('end_date')?.errors?.['minDate'] &&
              (orderForm.get('end_date')?.dirty || orderForm.get('end_date')?.touched)
            "
            class="text-red-500"
          >
            End date must be greater than or equal to start date.
          </small>
        </div>
        <div>
          <label class="font-medium text-gray-700 mb-2 block"> Status <span class="text-red-500">*</span> </label>
          <p-select
            styleClass="w-full"
            [options]="statusList"
            formControlName="status"
            placeholder="Select a status"
          ></p-select>
          <small
            *ngIf="
              orderForm.get('status')?.invalid && (orderForm.get('status')?.dirty || orderForm.get('status')?.touched)
            "
            class="text-red-500"
          >
            Please select a status.
          </small>
        </div>
      </div>

      <!-- Row 5: values -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
        <div>
          <label class="font-medium text-gray-700 mb-2 block" for="currency"
            >Currency <span class="text-red-500">*</span></label
          >
          <p-select
            styleClass="w-full"
            [options]="currencies"
            formControlName="currency"
            placeholder="Select currency"
            (onChange)="onCurrencyChange()"
          >
            <ng-template let-option pTemplate="item">
              <div class="flex items-center gap-2">
                <i *ngIf="option.icon" [class]="option.icon + ' text-lg mr-2 text-lime-600'"></i>
                <span>{{ option.label }}</span>
              </div>
            </ng-template>
          </p-select>
        </div>
        <div>
          <label class="font-medium text-gray-700 mb-2 block" for="total-value">
            Total Value <span class="text-red-500">*</span>
          </label>
          <p-inputnumber
            styleClass="w-full"
            formControlName="total_value"
            inputId="total-value"
            [mode]="'currency'"
            [currency]="orderForm.value.currency || 'USD'"
            [locale]="getLocale(orderForm.value.currency || 'USD')"
            [min]="0"
          />
          <!-- Loading enquanto cotações não carregam -->
          <div *ngIf="!ratesLoaded" class="flex items-center gap-2 text-gray-400 mt-1">
            <i class="pi pi-spin pi-spinner"></i> Carregando cotações...
          </div>
          <div *ngIf="orderForm.value.total_value && ratesLoaded">
            <div *ngFor="let c of getConvertedValues()" class="text-xs mt-1 text-gray-500">
              ≈ {{ c.value }} ({{ c.label }})
            </div>
          </div>

          <small
            *ngIf="total_value.errors?.['required'] && (total_value.dirty || total_value.touched)"
            class="text-red-500"
          >
            Value is required.
          </small>
          <small *ngIf="total_value.errors?.['min'] && (total_value.dirty || total_value.touched)" class="text-red-500">
            Value must be greater than or equal to 0.
          </small>
          <small *ngIf="total_value.errors?.['max'] && (total_value.dirty || total_value.touched)" class="text-red-500">
            Value must be less than or equal to 999999.99.
          </small>
        </div>
        <!-- Booster Value -->
        <div>
          <label class="font-medium text-gray-700 mb-2 block" for="booster-value">
            Booster Value (R$) <span class="text-red-500">*</span>
          </label>
          <p-inputnumber
            styleClass="w-full"
            formControlName="booster_value"
            inputId="booster-value"
            placeholder="R$ 0,00"
            [mode]="'currency'"
            [currency]="'BRL'"
            [locale]="'pt-BR'"
            [min]="0"
          />
          <!-- Loading -->
          <div *ngIf="!ratesLoaded" class="flex items-center gap-2 text-gray-400 mt-1">
            <i class="pi pi-spin pi-spinner"></i> Carregando cotações...
          </div>
          <!-- Conversão do booster_value para moeda escolhida -->
          <div *ngIf="ratesLoaded && orderForm.value.currency && orderForm.value.currency !== 'BRL'">
            <span class="text-xs mt-1 text-gray-500">
              ≈ {{ boosterConvertedValue }} ({{ getCurrencyLabel(orderForm.value.currency) }})
            </span>
          </div>
          <small
            *ngIf="booster_value.errors?.['required'] && (booster_value.dirty || booster_value.touched)"
            class="text-red-500"
          >
            Value is required.
          </small>
          <small
            *ngIf="booster_value.errors?.['min'] && (booster_value.dirty || booster_value.touched)"
            class="text-red-500"
          >
            Value must be greater than or equal to 0.
          </small>
          <small
            *ngIf="booster_value.errors?.['max'] && (booster_value.dirty || booster_value.touched)"
            class="text-red-500"
          >
            Value must be less than or equal to 999999.99.
          </small>
        </div>
      </div>

      <!-- Observation -->
      <div>
        <label class="font-medium text-gray-700 mb-2 block">Description / Notes</label>
        <textarea
          rows="5"
          cols="30"
          pTextarea
          formControlName="observation"
          placeholder="Fill in the service details, platform, order number, etc."
          class="w-full resize-y max-w-full"
        ></textarea>
        <small
          *ngIf="observation.errors?.['maxlength'] && (observation.dirty || observation.touched)"
          class="text-red-500"
        >
          Notes must be at most 500 characters.
        </small>
      </div>
    </div>

    <div class="flex justify-center md:justify-end gap-4 mt-2">
      <p-button label="Cancel" variant="outlined" severity="secondary" (click)="onCancel()" />
      <p-button label="Save Order" icon="pi pi-check" [disabled]="orderForm.invalid" (click)="onSubmit()" />
    </div>
  </form>
</div>
