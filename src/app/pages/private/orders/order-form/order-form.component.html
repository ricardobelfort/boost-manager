<div class="bg-white rounded-xl shadow-md p-8">
  <div class="flex items-center justify-between mb-4">
    <div>
      <h2 class="!text-3xl font-bold text-black">
        {{ editingId ? 'Editar Pedido' : 'Novo Pedido' }}
        <span *ngIf="editingId && orderForm.value.order_number" class="text-gray-400 ml-2"
          >#{{ orderForm.value.order_number }}</span
        >
      </h2>
      <p class="text-gray-500">
        {{ editingId ? 'Editando um pedido existente.' : 'Aqui você pode criar um novo pedido.' }}
      </p>
    </div>
  </div>

  <p-divider />

  <form [formGroup]="orderForm" (ngSubmit)="onSubmit()" class="flex flex-col gap-6">
    <!-- Linha 1: selects -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
      <div>
        <label class="font-medium text-gray-700 mb-2 block">Booster</label>
        <p-select
          styleClass="w-full"
          [options]="boosters"
          formControlName="booster"
          placeholder="Selecione um booster"
        ></p-select>
        <small
          *ngIf="
            orderForm.get('booster')?.invalid && (orderForm.get('booster')?.dirty || orderForm.get('booster')?.touched)
          "
          class="text-red-500"
        >
          Selecione um booster.
        </small>
      </div>
      <div>
        <label class="font-medium text-gray-700 mb-2 block">Fornecedor</label>
        <p-select
          styleClass="w-full"
          [options]="suppliers"
          formControlName="supplier"
          placeholder="Selecione um fornecedor"
        ></p-select>
        <small
          *ngIf="
            orderForm.get('supplier')?.invalid &&
            (orderForm.get('supplier')?.dirty || orderForm.get('supplier')?.touched)
          "
          class="text-red-500"
        >
          Selecione um fornecedor.
        </small>
      </div>
      <div>
        <label class="font-medium text-gray-700 mb-2 block">Tipo de Serviço</label>
        <p-select
          styleClass="w-full"
          [options]="serviceTypes"
          formControlName="service_type"
          placeholder="Selecione um tipo de serviço"
        ></p-select>
        <small
          *ngIf="
            orderForm.get('service_type')?.invalid &&
            (orderForm.get('service_type')?.dirty || orderForm.get('service_type')?.touched)
          "
          class="text-red-500"
        >
          Selecione um tipo de serviço.
        </small>
      </div>
      <div>
        <div *ngIf="typeof (orderForm.get('service_type')?.value ?? '') === 'string' && (orderForm.get('service_type')?.value ?? '').toLowerCase().includes('camuflagem')">
          <label class="font-medium text-gray-700 mb-2 block">Qtd. Armas</label>
          <p-inputnumber
            formControlName="weapon_quantity"
            [min]="1"
            [max]="33"
            [showButtons]="true"
            styleClass="w-full"
            placeholder="Ex: 1"
          ></p-inputnumber>
          <small
            *ngIf="
              orderForm.get('weapon_quantity')?.errors?.['required'] &&
              (orderForm.get('weapon_quantity')?.dirty || orderForm.get('weapon_quantity')?.touched)
            "
            class="text-red-500"
          >
            Informe a quantidade de armas.
          </small>
          <small
            *ngIf="
              orderForm.get('weapon_quantity')?.errors?.['min'] &&
              (orderForm.get('weapon_quantity')?.dirty || orderForm.get('weapon_quantity')?.touched)
            "
            class="text-red-500"
          >
            Mínimo 1 arma.
          </small>
          <small
            *ngIf="
              orderForm.get('weapon_quantity')?.errors?.['max'] &&
              (orderForm.get('weapon_quantity')?.dirty || orderForm.get('weapon_quantity')?.touched)
            "
            class="text-red-500"
          >
            Máximo 33 armas.
          </small>
        </div>
      </div>
    </div>

    <!-- Linha 2: dados da conta -->
    <div>
      <h3 class="text-lg font-semibold text-gray-800 mb-2">Dados da Conta</h3>
      <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
        <div class="flex flex-col">
          <label class="font-medium text-gray-700 mb-2 block">E-mail da Conta</label>
          <input
            styleClass="w-full"
            pInputText
            formControlName="account_email"
            placeholder="Digite seu e-mail"
            type="email"
          />
          <small
            *ngIf="
              orderForm.get('account_email')?.errors?.['required'] &&
              (orderForm.get('account_email')?.dirty || orderForm.get('account_email')?.touched)
            "
            class="text-red-500"
          >
            O e-mail é obrigatório.
          </small>
          <small
            *ngIf="
              orderForm.get('account_email')?.errors?.['email'] &&
              (orderForm.get('account_email')?.dirty || orderForm.get('account_email')?.touched)
            "
            class="text-red-500"
          >
            E-mail inválido.
          </small>
        </div>
        <div class="flex flex-col">
          <label class="font-medium text-gray-700 mb-2 block">Senha da Conta</label>
          <input
            styleClass="w-full"
            pInputText
            formControlName="account_password"
            placeholder="Digite sua senha"
            type="text"
          />
          <small
            *ngIf="
              orderForm.get('account_password')?.errors?.['required'] &&
              (orderForm.get('account_password')?.dirty || orderForm.get('account_password')?.touched)
            "
            class="text-red-500"
          >
            A senha é obrigatória.
          </small>
        </div>
        <div class="flex flex-col">
          <label class="font-medium text-gray-700 mb-2 block">Códigos de Backup</label>
          <input
            styleClass="w-full"
            pInputText
            formControlName="recovery_code"
            placeholder="Digite o código de backup"
            type="text"
          />
          <small
            *ngIf="
              orderForm.get('recovery_code')?.errors?.['required'] &&
              (orderForm.get('recovery_code')?.dirty || orderForm.get('recovery_code')?.touched)
            "
            class="text-red-500"
          >
            O código de recuperação é obrigatório.
          </small>
        </div>
        <div class="flex flex-col">
          <label class="font-medium text-gray-700 mb-2 block">E-mail de recuperação</label>
          <input
            styleClass="w-full"
            pInputText
            formControlName="recovery_email"
            placeholder="Digite o e-mail de recuperação"
            type="text"
          />
          <small
            *ngIf="
              orderForm.get('recovery_email')?.errors?.['required'] &&
              (orderForm.get('recovery_email')?.dirty || orderForm.get('recovery_email')?.touched)
            "
            class="text-red-500"
          >
            O e-mail de recuperação é obrigatório.
          </small>
        </div>
        <div class="flex flex-col">
          <label class="font-medium text-gray-700 mb-2 block">Plataforma</label>
          <p-select
            styleClass="w-full"
            [options]="platforms"
            formControlName="platform"
            placeholder="Selecione uma plataforma"
          ></p-select>
          <small
            *ngIf="
              orderForm.get('platform')?.invalid &&
              (orderForm.get('platform')?.dirty || orderForm.get('platform')?.touched)
            "
            class="text-red-500"
          >
            Selecione uma plataforma.
          </small>
        </div>
      </div>
    </div>

    <!-- Linha 3: datas -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <div>
        <label class="font-medium text-gray-700 mb-2 block">Data de Início</label>
        <p-datepicker
          styleClass="w-full"
          formControlName="start_date"
          dateFormat="dd/mm/yy"
          placeholder="Selecione a data de início"
          [showIcon]="true"
          [showButtonBar]="true"
          [selectOtherMonths]="true"
          [minDate]="hoje"
        ></p-datepicker>
        <small
          *ngIf="
            orderForm.get('start_date')?.errors?.['required'] &&
            (orderForm.get('start_date')?.dirty || orderForm.get('start_date')?.touched)
          "
          class="text-red-500"
        >
          A data de início é obrigatória.
        </small>
        <small
          *ngIf="
            orderForm.get('start_date')?.errors?.['minDate'] &&
            (orderForm.get('start_date')?.dirty || orderForm.get('start_date')?.touched)
          "
          class="text-red-500"
        >
          A data de início deve ser maior ou igual à data atual.
        </small>
        <small
          *ngIf="
            orderForm.get('start_date')?.errors?.['maxDate'] &&
            (orderForm.get('start_date')?.dirty || orderForm.get('start_date')?.touched)
          "
          class="text-red-500"
        >
          A data de início não pode ser maior que a data de fim.
        </small>
      </div>
      <div>
        <label class="font-medium text-gray-700 mb-2 block">Data de Fim</label>
        <p-datepicker
          styleClass="w-full"
          formControlName="end_date"
          dateFormat="dd/mm/yy"
          placeholder="Selecione a data de fim"
          [showIcon]="true"
          [showButtonBar]="true"
          [selectOtherMonths]="true"
          [minDate]="hoje"
        ></p-datepicker>
        <small
          *ngIf="
            orderForm.get('end_date')?.errors?.['required'] &&
            (orderForm.get('end_date')?.dirty || orderForm.get('end_date')?.touched)
          "
          class="text-red-500"
        >
          A data de fim é obrigatória.
        </small>
        <small
          *ngIf="
            orderForm.get('end_date')?.errors?.['minDate'] &&
            (orderForm.get('end_date')?.dirty || orderForm.get('end_date')?.touched)
          "
          class="text-red-500"
        >
          A data de fim deve ser maior ou igual à data de início.
        </small>
      </div>
      <div>
        <label class="font-medium text-gray-700 mb-2 block">Status</label>
        <p-select
          styleClass="w-full"
          [options]="statusList"
          formControlName="status"
          placeholder="Selecione um status"
        ></p-select>
        <small
          *ngIf="
            orderForm.get('status')?.invalid && (orderForm.get('status')?.dirty || orderForm.get('status')?.touched)
          "
          class="text-red-500"
        >
          Selecione um status.
        </small>
      </div>
    </div>

    <!-- Linha 5: valores -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <label class="font-medium text-gray-700 mb-2 block" for="total-value">Valor Total</label>
        <p-inputnumber
          styleClass="w-full"
          formControlName="total_value"
          inputId="total-value"
          placeholder="R$ 0,00"
          mode="currency"
          currency="BRL"
          locale="pt-BR"
          [min]="0"
        />
        <small *ngIf="total_value.errors?.['required'] && (total_value.dirty || total_value.touched)" class="text-red-500">
          Valor obrigatório.
        </small>
        <small *ngIf="total_value.errors?.['min'] && (total_value.dirty || total_value.touched)" class="text-red-500">
          Valor deve ser maior ou igual a 0.
        </small>
        <small *ngIf="total_value.errors?.['max'] && (total_value.dirty || total_value.touched)" class="text-red-500">
          Valor deve ser menor ou igual a 999999.99.
        </small>
      </div>
      <div>
        <label class="font-medium text-gray-700 mb-2 block" for="booster-value">Valor do Booster</label>
        <p-inputnumber
          styleClass="w-full"
          formControlName="booster_value"
          inputId="booster-value"
          placeholder="R$ 0,00"
          mode="currency"
          currency="BRL"
          locale="pt-BR"
          [min]="0"
        />
        <small
          *ngIf="booster_value.errors?.['required'] && (booster_value.dirty || booster_value.touched)"
          class="text-red-500"
        >
          Valor obrigatório.
        </small>
        <small
          *ngIf="booster_value.errors?.['min'] && (booster_value.dirty || booster_value.touched)"
          class="text-red-500"
        >
          Valor deve ser maior ou igual a 0.
        </small>
        <small
          *ngIf="booster_value.errors?.['max'] && (booster_value.dirty || booster_value.touched)"
          class="text-red-500"
        >
          Valor deve ser menor ou igual a 999999.99.
        </small>
      </div>
    </div>

    <!-- Observação -->
    <div>
      <label class="font-medium text-gray-700 mb-2 block">Descrição / Observação</label>
      <textarea
        rows="5"
        cols="30"
        pTextarea
        formControlName="observation"
        class="w-full resize-y max-w-full"
      ></textarea>
      <small
        *ngIf="observation.errors?.['maxlength'] && (observation.dirty || observation.touched)"
        class="text-red-500"
      >
        A observação deve ter no máximo 500 caracteres.
      </small>
    </div>

    <div class="flex justify-center md:justify-end gap-4 mt-2">
      <p-button label="Cancelar" variant="outlined" severity="secondary" (click)="onCancel()" />
      <p-button label="Salvar Pedido" icon="pi pi-check" [disabled]="orderForm.invalid" (click)="onSubmit()" />
    </div>
  </form>
</div>
