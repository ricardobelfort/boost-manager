<div class="bg-white rounded-xl shadow-md p-8">
  <div class="flex flex-col md:flex-row items-center justify-between mb-4 gap-4">
    <div>
      <h2 class="!text-3xl font-bold text-black">Pedidos</h2>
      <p class="text-gray-500">Aqui você pode visualizar todos os pedidos realizados.</p>
    </div>
    <div class="flex gap-2 w-full md:w-auto">
      <p-iconfield>
        <p-inputicon styleClass="pi pi-search" />
        <input type="text" pInputText [(ngModel)]="search" placeholder="Buscar pedidos..." />
      </p-iconfield>
      <p-button label="Novo Pedido" icon="pi pi-plus" [routerLink]="['novo']" />
    </div>
  </div>

  <p-divider />

  <p-table
    [value]="filteredOrders"
    [paginator]="true"
    [rows]="10"
    [rowsPerPageOptions]="[10, 20, 50]"
    [responsiveLayout]="'scroll'"
    [showCurrentPageReport]="true"
    currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} pedidos"
  >
    <ng-template pTemplate="header">
      <tr>
        <th>Booster</th>
        <th>Serviço</th>
        <th># Pedido</th>
        <th pSortableColumn="status">Status <p-sortIcon field="status" /></th>
        <th pSortableColumn="start_date">Início <p-sortIcon field="start_date" /></th>
        <th pSortableColumn="end_date">Término <p-sortIcon field="end_date" /></th>
        <th pSortableColumn="total_value">Valor Total <p-sortIcon field="total_value" /></th>
        <th pSortableColumn="booster_value">Valor Booster <p-sortIcon field="booster_value" /></th>
        <th>Ações</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-order>
      <tr>
        <td class="text-sm">{{ order.booster }}</td>
        <td class="text-sm">{{ order.service_type }}</td>
        <td class="text-sm">#{{ order.order_number }}</td>
        <td class="text-sm">
          <span
            class="px-2 py-1 rounded-lg font-medium"
            [ngClass]="{
              'bg-yellow-100 text-yellow-800': order.status === 'Aguardando',
              'bg-blue-100 text-blue-800': order.status === 'Em andamento',
              'bg-green-100 text-green-800': order.status === 'Concluído',
            }"
          >
            {{ order.status }}
          </span>
        </td>
        <td class="text-sm">{{ order.start_date ? (order.start_date | date: 'dd/MM/yy' : '' : 'pt-BR') : '-' }}</td>
        <td class="text-sm">{{ order.end_date ? (order.end_date | date: 'dd/MM/yy' : '' : 'pt-BR') : '-' }}</td>
        <td class="text-sm">R$ {{ order.total_value | number: '1.2-2' }}</td>
        <td class="text-sm">R$ {{ order.booster_value | number: '1.2-2' }}</td>
        <td>
          <p-button
            icon="pi pi-tag"
            [rounded]="true"
            [text]="true"
            severity="secondary"
            (click)="openViewDialog(order)"
            title="Visualizar"
          />
          <p-button
            icon="pi pi-pencil"
            [rounded]="true"
            [text]="true"
            severity="success"
            (click)="editOrder(order)"
            title="Editar"
          />
          <p-button
            icon="pi pi-trash"
            [rounded]="true"
            [text]="true"
            severity="danger"
            (click)="confirmDelete(order)"
            title="Excluir"
          />
        </td>
      </tr>
    </ng-template>
    <ng-template pTemplate="emptymessage">
      <tr>
        <td [attr.colspan]="9" class="py-20">
          <div class="flex flex-col items-center justify-center">
            <div class="rounded-full bg-purple-100 w-20 h-20 flex items-center justify-center mb-4">
              <i class="pi pi-box text-4xl text-yellow-500"></i>
            </div>
            <h3 class="font-bold text-xl text-gray-900 mb-1">Ainda não tem pedidos</h3>
            <p class="text-gray-500 text-base">Aqui é onde você visualizará e gerenciará os pedidos.</p>
          </div>
        </td>
      </tr>
    </ng-template>
  </p-table>
  <p-toast></p-toast>
  <p-confirmDialog></p-confirmDialog>
</div>

<!-- FORMULÁRIO DE NOVO PEDIDO (modal ou inline) -->
<app-order-form *ngIf="showOrderForm" (close)="closeOrderForm()" />

<p-dialog
  header="Detalhes do Pedido"
  [(visible)]="viewDialogVisible"
  [modal]="true"
  [style]="{ width: '450px' }"
  [closable]="true"
  (onHide)="closeViewDialog()"
>
  <ng-container *ngIf="orderToView">
    <div class="flex flex-col gap-3">
      <div><b>Número do pedido:</b> #{{ orderToView.order_number }}</div>
      <div><b>Booster:</b> {{ orderToView.booster }}</div>
      <div><b>Tipo de serviço:</b> {{ orderToView.service_type }}</div>
      <div *ngIf="orderToView.weapon_quantity"><b>Qtd. Armas:</b> {{ orderToView.weapon_quantity }}</div>
      <div><b>Fornecedor:</b> {{ orderToView.supplier }}</div>
      <div><b>Status:</b> {{ orderToView.status }}</div>
      <div><b>Data início:</b> {{ orderToView.start_date | date: 'dd/MM/yyyy HH:mm' }}</div>
      <div><b>Data fim:</b> {{ orderToView.end_date | date: 'dd/MM/yyyy HH:mm' }}</div>
      <div><b>Valor total:</b> R$ {{ orderToView.total_value | number: '1.2-2' }}</div>
      <div><b>Valor do booster:</b> R$ {{ orderToView.booster_value | number: '1.2-2' }}</div>
      <div><b>Observação:</b> {{ orderToView.observation }}</div>
    </div>
  </ng-container>
</p-dialog>
